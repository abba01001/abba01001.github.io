---
title: 搭建V2Ray服务器（ws+tls+web）
date: 2024-11-16 19:30:00
author: abba01001
categories: 工具
---
## 前言

本文是搭建V2Ray服务器（ws+tls+web）的完整教程。

![](https://abab01001-1318826377.cos.ap-guangzhou.myqcloud.com/BlogData/Image/202411161906081.png)

如果墙主动访问代理服务器，会发现流量的目的地没有真正的网站，从而识破https流量的目的。

使用https流量不做掩护，反而增大了IP被墙的概率。因此你需要在V2Ray服务外面加一层真网站做掩护。

![](https://abab01001-1318826377.cos.ap-guangzhou.myqcloud.com/BlogData/Image/202411161906358.png)

这就是V2Ray+ws+tls再加上web的原理。在配置了真实网站之后，只有你自己知道是个代理，在别人看来是个网站（包括墙）。

反过来说，V2Ray+ws+tls+web也可以看作是自建了一个网站，然后利用这个网站来翻墙。因此，如果你读完本文，不仅能学会V2Ray翻墙，还能学到一点建网站的流程。

上面“https流量”的正确叫法是“tls流量”，这东西就是你平时浏览网页发出的流量。这里为了方便新手理解，叫做“https流量”。

安全提示：

> 如果服务器之前运行过SS，SSR，V2Ray（非TLS）等服务，请确保先停止原来的代理服务，再安装V2Ray。如果不知道怎么停止，请重装VPS（在网页控制面板上点reinstall，不到一分钟就搞定）。翻墙的隐蔽性取决于最薄弱的一环，如果服务器上同时运行其它代理软件，这些代理软件依然会被墙探测到，这种情况下V2Ray+ws+tls+web并不能保证隐蔽性。

自建网站看上去很复杂，其实很简单，只要按照以下步骤：

1 购买域名&配置域名解析：V2Ray需要域名伪装成真正的网站，因此你需要购买一个域名，并把域名绑定到服务器的IP地址上。

2 一键填写配置文件：本文已经写好了配置文件，只要把域名，UUID等信息填进去就行了。

3 一键安装v2ray+nginx

4 上传配置文件&一键运行

5 配置客户端

成功翻墙以后，还可以做以下事情进一步强化：

可选1. 加固服务器

可选2. 配置CDN隐藏IP

可选3. 使用BBR加速

下面按照以上顺序讲解配置。

## 1.购买域名&配置域名解析

1.1自行百度购买域名，购买的域名例子www.hrw1rdzqa7c5a8u3ibkn.website

1.2 注册CloudFlare。

打开Cloudflare官网，用邮箱注册，如图。注册页面入口[https://dash.cloudflare.com/sign-up](https://dash.cloudflare.com/sign-up)

接下来输入刚才购买的域名，注意这里输入的是【二级域名】。所谓二级域名，可以理解为网址去掉www。 比如我的网站的网址是www.hrw1rdzqa7c5a8u3ibkn.website，那么这里应该输入hrw1rdzqa7c5a8u3ibkn.website，如图：

![](https://abab01001-1318826377.cos.ap-guangzhou.myqcloud.com/BlogData/Image/202411161910495.png)

点【Add Site】，把域名交给Cloudflare托管。

接下来选择套餐，这里选择FREE套餐。

![](https://abab01001-1318826377.cos.ap-guangzhou.myqcloud.com/BlogData/Image/202411161911239.png)

点【Confirm Plan】，进入管理页面，不要关掉页面，接下来配置域名解析。

1.4 配置域名解析

配置域名解析分两步：

配置域名服务器记录（也叫name server，NS记录）

配置地址解析记录（也叫address，A记录）

NS记录用来表明由哪台服务器对域名进行解析。从GoDaddy买到域名后，域名是由Godaddy的服务器进行解析的。我们这里把Godaddy的服务器换成Cloudflare的服务器。

如图是Cloudflare的管理界面，如果你的域名之前有配置域名解析，管理界面会显示之前的记录。暂时不用管这些。 点Continue，修改域名服务器。

点【Continue with default】

![](https://abab01001-1318826377.cos.ap-guangzhou.myqcloud.com/BlogData/Image/202411161911426.png)

接下来Cloudflare会提示你变更域名服务器，并给出了方法。

![](https://abab01001-1318826377.cos.ap-guangzhou.myqcloud.com/BlogData/Image/202411161911288.png)

画红框的部分就是Cloudflare提供的两个域名服务器，我这里是ns90.domaincontrol.com和ns91.domaincontrol.com， 你看到的的可能和我不一样。

回到你购买域名服务器的地方，查看域名两个的服务器

修改位刚才Cloudflare提供的两个域名服务器，我这里是fccp.ns.cloudflare.com和xjp.ns.cloudflare.com， 点击【保存】。



注意不要有多余的域名服务器，不是CloudFlare提供的就要删除，否则可能会出问题。

接下来转移域名服务器可能需要几分钟，转移完成后会收到Cloudflare的邮件，可以先等一阵子。

配置地址解析（A记录） 转移域名服务器完成后，进入cloudflare的首页，点击右上角的【log in】，进入你的账户，如图：

![](https://abab01001-1318826377.cos.ap-guangzhou.myqcloud.com/BlogData/Image/202411161914760.png)

点击买来的域名，进入下一步，如图：

![](https://abab01001-1318826377.cos.ap-guangzhou.myqcloud.com/BlogData/Image/202411161915536.png)

点击【DNS】按钮，进入Cloudflare的DNS管理页面，如下图：

![](https://abab01001-1318826377.cos.ap-guangzhou.myqcloud.com/BlogData/Image/202411161915047.png)

点击【Add record】，一次可以添加一条解析记录.

这里简单讲解一下，如果不想了解原理，可以跳过这一部分。

每条域名解析有四个部分：Type，Name，Address，TTL

Type是域名解析的类型，常见的几种有

* A记录：即地址（Address）记录，用来指定域名的IPv4地址。如果需要将域名指向一个IP地址，就需要添加A记录。举个例子，我们要把域名www.hrw1rdzqa7c5a8u3ibkn.website指向VPS的IP地址218.30.118.6，就要添加A记录。
* AAAA记录，指定域名的IPv6地址。
* CNAME：即规范名字（Canonical Name）记录，俗称“别名”。如果需要把域名指向另一个域名，就要添加CNAME记录。
* NS：域名服务器记录，如果要把域名交给其他DNS服务器解析，就需要添加NS记录。我们刚才修改的就是NS记录。

接下来说明每个选项应该填什么，以及为什么这么填：

Name

对于A记录，这里介绍三种填法

* www：表示解析带www的域名，即www.hrw1rdzqa7c5a8u3ibkn.website
* @：直接解析裸域名，即hrw1rdzqa7c5a8u3ibkn.website
* _：表示泛解析，即匹配其他所有域名_.hrw1rdzqa7c5a8u3ibkn.website

Address

这里填VPS的IP地址，我这里是218.30.118.6

TTL

即 Time To Live，缓存的生存时间。指本地dns缓存解析记录的时间，缓存失效后会再次获取记录。在Cloudflare里，如果配置了CDN，则这里填Auto即可；如果没有配置CDN，可以选择Auto，也可以选择一个大于1小时的值。

理解了上面的内容以后，接下来添加两条A记录（如果VPS只有IPv6地址则添加AAAA记录）

点一下云朵，确保云是灰色的（DNS only）。橘色云朵表示此解析记录使用CDN，灰色云朵表示不使用 CDN，点击云朵可以切换。这里不要使用CDN，否则接下来的配置会出问题。

* 第一条A记录，name填www，address填服务器IP地址，TTL选择1小时。（表示解析带www的地址）
* 第二条A记录，name填@，address填服务器IP地址，TTL选择1小时。（表示解析不带www的裸域名）

填好之后的正确结果如图：

![](https://abab01001-1318826377.cos.ap-guangzhou.myqcloud.com/BlogData/Image/202411161915062.png)

注意云一定是灰色的。

检查是否配置成功： 配置完成后点【save】就大功告成了，可以打开windows的powershell，输入

`ping www.hrw1rdzqa7c5a8u3ibkn.website`

\(替换成你的域名\)

Ping一下你的域名，如果能Ping通，就说明域名解析没问题。

## 2. 配置文件

V2Ray和Nginx的配置文件这里已经写好。你需要做的就是填表格，把配置中标出的地方换成自己的内容。 编辑配置文件可以用Windows记事本，不过推荐使用Notepad++。

下载地址： [网页链接，直接下载链接\(7.8.4\)](https://notepad-plus-plus.org/downloads/)

2.1 V2Ray配置文件

V2Ray配置文件如下：

```
{
"inbound": {
    "protocol": "vmess",
    "listen": "127.0.0.1",
 "port": 9696,
 "settings": {"clients": [
        {"id": "bc0d0a35-0218-4d66-8bcf-f384bd6cf905"}
    ]},
 "streamSettings": {
 "network": "ws",
 "wsSettings": {"path": "/h5j9QKvr64g"}
    }
},

"outbound": {"protocol": "freedom"}
}
```

把V2Ray的配置文件另存为config.json

2.2 Nginx配置文件

Nginx配置文件如下：

```text
#user  nobody;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       mime.types;
    default_type  application/octet-stream;

    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
    #                  '$status $body_bytes_sent "$http_referer" '
    #                  '"$http_user_agent" "$http_x_forwarded_for"';

    #access_log  logs/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;

	server {
    ### 1:
		server_name www.abba01001.fun;

		listen 80;
		rewrite ^(.*) https://$server_name$1 permanent;
		if ($request_method  !~ ^(POST|GET)$) { return  501; }
		autoindex off;
		server_tokens off;
	}
	
	server {
		ssl_certificate "C:/Certbot/live/www.abba01001.fun/fullchain.pem";
		ssl_certificate_key "C:/Certbot/live/www.abba01001.fun/privkey.pem";

    ### 4:
		location /h5j9QKvr64g
		{
			proxy_pass http://127.0.0.1:9696;
			proxy_redirect off;

			proxy_http_version 1.1;
			proxy_set_header Upgrade $http_upgrade;
			proxy_set_header Connection "upgrade";
			proxy_set_header Host $host;

			sendfile on;
			tcp_nopush on;
			tcp_nodelay on;
			keepalive_requests 25600;
			keepalive_timeout 300 300;
			proxy_buffering off;
			proxy_buffer_size 8k;
		}

		listen 443 ssl http2;
		server_name $server_name;
		charset utf-8;

		ssl_protocols TLSv1.2 TLSv1.3;
		ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!3DES:!MD5:!PSK;
		ssl_prefer_server_ciphers on;

		ssl_session_cache shared:SSL:60m;
		ssl_session_timeout 1d;
		ssl_session_tickets off;

		ssl_stapling on;
		ssl_stapling_verify on;
		resolver 8.8.8.8 8.8.4.4 valid=300s;
		resolver_timeout 10s;

    # Security settings
		if ($request_method  !~ ^(POST|GET)$) { return 501; }
		add_header X-Frame-Options DENY;
		add_header X-XSS-Protection "1; mode=block";
		add_header X-Content-Type-Options nosniff;
		add_header Strict-Transport-Security max-age=31536000 always;
		autoindex off;
		server_tokens off;

		index index.html index.htm index.php;
		root /usr/share/nginx/html;
		location ~ .*\.(js|jpg|JPG|jpeg|JPEG|css|bmp|gif|GIF|png)$ { access_log off; }
	}
}

```

把Nginx的配置文件另存为nginx.conf（注意扩展名就是.conf）

## 3.上传配置 & 运行

3.1 连接到服务器，安装v2ray+Nginx

很多新手在买到VPS之后不知所措，其实VPS和游戏账号是一样的，买游戏账号付款之后，店家会私信告诉你两件东西：

> 用户名，密码

买VPS付款之后，VPS提供商会给你发邮件，告诉你四件东西：

> IP地址，密码，登录账号，端口

IP地址和密码一定会有，登录账号如果没说，默认是root。端口如果没说，默认填22.

拿到登录信息之后，就可以登录服务器了。这里推荐Bitvise SSH，轻量级，但是功能强大。

下载链接：[https://www.bitvise.com/ssh-client-download](https://www.bitvise.com/ssh-client-download)

直接下载链接：[https://dl.bitvise.com/BvSshClient-Inst.exe](https://dl.bitvise.com/BvSshClient-Inst.exe)

安装好之后的界面如下图，点红框圈起的下拉菜单，【Initial method】下拉菜单里面选【password】，在【Store encrypted password in profile】选项上打勾。

![](https://abab01001-1318826377.cos.ap-guangzhou.myqcloud.com/BlogData/Image/202411161919264.png)

这里假定我们的IP地址是218.30.118.6，密码是12345，登录账号和密码分别是root和22. 如图：

* 【Host】：这里填IP地址
* 【Port】：这里填端口，如果没说就是22
* 【Username】：这里填用户名，如果没说就是root
* 【Password】：登录密码。

填好之后如下图，点【Log in】就可以登录了。

![](https://abab01001-1318826377.cos.ap-guangzhou.myqcloud.com/BlogData/Image/202411161920225.png)

第一次登录服务器会弹出窗口，问是否要保存密钥，点【Accept and save】继续。

成功登录之后会弹出两个窗口。

![](https://abab01001-1318826377.cos.ap-guangzhou.myqcloud.com/BlogData/Image/202411161920580.png)

![](https://abab01001-1318826377.cos.ap-guangzhou.myqcloud.com/BlogData/Image/202411161920486.png)

一个是文件浏览窗口，使用方法和Windows资源管理器一样，这里可以浏览服务器上的文件。把电脑中的文件拖拽到这里，就可以把文件上传到服务器。

另一个黑色的窗口是命令窗口。在电脑上复制一段文字，在这个窗口上右键，就可以把文字粘贴到命令窗口。

3.2 配置SSL证书

为了用真正的https流量翻墙，我们的网站必须有合法的SSL证书。可以用自动化工具Certbot申请证书，只要把以下命令复制到命令窗口，依次执行即可。

这里说的“证书”，实际指的是“数字证书”。当然申请完全是免费的，申请时需要邮箱地址。如有必要，可以使用匿名邮箱。

\(1\) 自行百度安装Certbot和python

\(2\) 关闭防火墙 

\(3\) 申请SSL证书 `certbot certonly --standalone --agree-tos -n -d www.●●●●●● -d ●●●●●● -m ▲▲▲@▲▲▲.▲▲▲`

第一个-d加一个带www的域名，第二个-d加一个不带www的域名，-m后面加你的电子邮箱。

注意前后要带空格。

例子：（域名：www.hrw1rdzqa7c5a8u3ibkn.website，邮箱：xijinping@protonmail.com）

```text
certbot certonly --standalone --agree-tos -n -d www.hrw1rdzqa7c5a8u3ibkn.website -d hrw1rdzqa7c5a8u3ibkn.website -m xijinping@protonmail.com
```

运行这条命令后，如果显示：

> IMPORTANT NOTES:
>
> * Congratulations! Your certificate and chain have been saved at:
>
>   /etc/letsencrypt/live/www.hrw1rdzqa7c5a8u3ibkn.website/fullchain.pem
>
>   Your key file has been saved at:
>
>   /etc/letsencrypt/live/www.hrw1rdzqa7c5a8u3ibkn.website/privkey.pem
>
>   Your cert will expire on 2020-06-04. To obtain a new or tweaked
>
>   version of this certificate in the future, simply run certbot
>
>   again. To non-interactively renew _all_ of your certificates, run
>
>   "certbot renew"
>
> * Your account credentials have been saved in your Certbot
>
>   configuration directory at /etc/letsencrypt. You should make a
>
>   secure backup of this folder now. This configuration directory will
>
>   also contain certificates and private keys obtained by Certbot so
>
>   making regular backups of this folder is ideal.
>
> * If you like Certbot, please consider supporting our work by:
>
> Donating to ISRG / Let's Encrypt: [https://letsencrypt.org/donate](https://letsencrypt.org/donate) Donating to EFF: [https://eff.org](https://eff.org)

就表示成功。

注意：这一步比较容易出错，常见的问题有：

* 其它代理占用了80，443端口。解决方法：停止其它代理软件，或重装VPS。
* 没有正确配置域名解析。解决方法：ping一下域名，看看能不能正确解析到IP。注意不要打开CDN（云朵点灰）。
* 没有关闭防火墙。解决方法：回到（2），关闭防火墙。

\(4\) 申请的证书只有三个月期限，记得续期

3.3 安装V2Ray和Nginx

## 4 上传配置文件&运行

安装好V2Ray和Nginx后，我们终于来到了最后一步。在启动V2Ray之前，需要把之前的配置文件上传

4.1 将之前写好的config.json覆盖配置文件v2ray目录下。

nginx.conf覆盖到nginx/conf目录下

4.2 自行百度启动v2ray和nginx

配置完成后，可以在浏览器里输入域名网址，如果显示Nginx界面，就说明网址配置成功了！

接下来要做的是上传一个网页模板，这样别人访问你的服务器就会看到一个真的网站。

4.3 上传网页模板

去Google上搜“website template”可以找到很多提供网页模板的网站，随便找一家。网页模板强烈建议用纯英文模板，其中不要包含任何中文内容，否则（可能）会增加网站被墙的概率。下载好以后，解压压缩文件，一路点开，如图，可以看到里面有一个index.html文件\(有些是index.htm或index.php\)

![img4.3.1](https://abab01001-1318826377.cos.ap-guangzhou.myqcloud.com/BlogData/Image/202411161925428.png)

把这个文件夹里的所有东西，包括index.html，blog.html，以及css，fonts，img，js几个文件夹，全部上传到 nginx/html/ 目录下面。

接下来打开网址，这时候可以看到一个真正的网站。

## 5 客户端配置

配置完成后如下图:

![](https://abab01001-1318826377.cos.ap-guangzhou.myqcloud.com/BlogData/Image/202411161925766.png)

到这一步结束，整个V2Ray翻墙的搭建就结束了。
